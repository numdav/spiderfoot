name: Python Test Pipeline

# Esegue la pipeline su ogni push o pull request verso il branch main (o master)
on:
  push:
    branches: [ "main", "master" ]
  pull_request:
    branches: [ "main", "master" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    # 1. Scarica il codice del repository
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. Imposta Python (puoi cambiare la versione se necessario, es. '3.9', '3.11')
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip' # Attiva la cache per velocizzare le installazioni future

    # 3. Installa le dipendenze (Il tuo primo comando)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip3 install -r test/requirements.txt

    # 4. Lancia i test (Il tuo secondo comando)
    - name: Run Pytest with Flake8 and Coverage
      run: |
        python3 -m pytest -n auto --flake8 --dist loadfile --durations=5 --cov-report html --cov=. .

    # 5. (Opzionale ma consigliato) Salva il report HTML generato come artefatto
    # Dato che usi --cov-report html, questo ti permette di scaricare il report da GitHub
    - name: Upload Coverage Report
      uses: actions/upload-artifact@v4
      if: always() # Esegue questo step anche se i test falliscono
      with:
        name: html-coverage-report
        path: htmlcov/
